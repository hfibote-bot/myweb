<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>3D 原子轨道全系可视化 (s, p, d, f)</title>
    <style>
        body { margin: 0; overflow: hidden; background-color: #050505; color: white; font-family: sans-serif; }
        #info {
            position: absolute;
            top: 10px;
            width: 100%;
            text-align: center;
            pointer-events: none;
            z-index: 10;
        }
        #controls {
            position: absolute;
            top: 50px;
            width: 100%;
            text-align: center;
            pointer-events: auto;
            z-index: 10;
        }
        button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 8px 16px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 4px;
            transition: 0.3s;
        }
        button:hover, button.active {
            background: rgba(30, 144, 255, 0.6);
            border-color: #1e90ff;
        }
        #legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            pointer-events: none;
            max-width: 300px;
        }
        .key { display: inline-block; width: 10px; height: 10px; margin-right: 5px; }
    </style>
    <script type="importmap">
      {
        "imports": {
          "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
          "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
      }
    </script>
</head>
<body>

    <div id="info">
        <h2>3D 电子轨道结构 (s, p, d, f)</h2>
    </div>

    <div id="controls">
        <button onclick="updateOrbital('1s')" class="active" id="btn-1s">1s 态</button>
        <button onclick="updateOrbital('2s')" id="btn-2s">2s 态 (有节点)</button>
        <button onclick="updateOrbital('2p')" id="btn-2p">2p 态 (哑铃)</button>
        <button onclick="updateOrbital('3d')" id="btn-3d">3d 态 (花瓣)</button>
        <button onclick="updateOrbital('4f')" id="btn-4f">4f 态 (复杂立体)</button>
    </div>

    <div id="legend">
        <div id="desc-title" style="font-weight:bold; margin-bottom:5px;">1s 轨道</div>
        <div id="desc-text">最基础的球形。电子云密度随距离衰减。</div>
        <div style="margin-top:10px;">
            <span class="key" style="background:#00ffff;"></span>正相位 (+)
            <span class="key" style="background:#ff0055; margin-left:10px;"></span>负相位 (-)
        </div>
        <div style="font-size:12px; color:#aaa; margin-top:5px;">提示：鼠标左键旋转，滚轮缩放</div>
    </div>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

    // --- 初始化场景 ---
    const scene = new THREE.Scene();
    scene.fog = new THREE.FogExp2(0x050505, 0.02);

    const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.z = 25;

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // --- 粒子系统设置 ---
    let particles;
    const particleCount = 25000; // 粒子数量，越多越清晰但越卡

    // 创建粒子材质
    const material = new THREE.PointsMaterial({
        size: 0.15,
        vertexColors: true, // 允许每个粒子有不同颜色
        transparent: true,
        opacity: 0.8,
        blending: THREE.AdditiveBlending
    });

    // --- 核心数学逻辑：波函数概率模拟 ---
    // 为了可视化效果，这里使用简化的波函数角分布形状函数
    
    function getProbability(x, y, z, type) {
        const r = Math.sqrt(x*x + y*y + z*z);
        if (r === 0) return { p: 0, phase: 1 };
        
        // 归一化方向向量
        const nx = x/r; 
        const ny = y/r;
        const nz = z/r;

        let prob = 0;
        let phase = 1; // 1 为正，-1 为负

        switch(type) {
            case '1s': 
                // 简单的指数衰减
                prob = Math.exp(-r);
                phase = 1;
                break;

            case '2s':
                // 径向节点：(2 - r) * e^(-r/2)
                // 在 r=2 附近概率为0（节点），内外相位相反
                let radialPart = (2 - r) * Math.exp(-r/2);
                prob = radialPart * radialPart; // 概率是波函数的平方
                phase = (2 - r) > 0 ? 1 : -1;   // 相位看波函数正负
                break;

            case '2p':
                // pz 轨道：z/r * e^(-r/2)
                // 哑铃形状，沿Z轴
                prob = Math.pow(nz * Math.exp(-r/2), 2) * 5; 
                phase = nz > 0 ? 1 : -1;
                break;

            case '3d':
                // d_x2-y2 轨道 (四叶草形状)：(x^2 - y^2)/r^2
                // xy平面的四瓣花
                let angularD = (nx*nx - ny*ny);
                prob = Math.pow(angularD * Math.exp(-r/3), 2) * 20;
                phase = angularD > 0 ? 1 : -1;
                break;

            case '4f':
                // f_xyz 轨道 (八叶花)：xyz/r^3
                // 指向立方体8个角的复杂形状
                let angularF = nx * ny * nz;
                prob = Math.pow(angularF * Math.exp(-r/4), 2) * 300;
                phase = angularF > 0 ? 1 : -1;
                break;
        }
        
        return { p: prob, phase: phase };
    }

    // --- 生成点云 ---
    function generateOrbital(type) {
        if (particles) scene.remove(particles);

        const positions = [];
        const colors = [];
        const colorPos = new THREE.Color(0x00ffff); // 青色 (正相位)
        const colorNeg = new THREE.Color(0xff0055); // 红色 (负相位)

        let count = 0;
        let attempts = 0;
        const maxRange = 10; // 采样空间范围

        // 蒙特卡洛采样 (Rejection Sampling)
        while (count < particleCount && attempts < 1000000) {
            attempts++;
            // 随机选点
            const x = (Math.random() - 0.5) * 2 * maxRange;
            const y = (Math.random() - 0.5) * 2 * maxRange;
            const z = (Math.random() - 0.5) * 2 * maxRange;

            // 计算该点的概率密度
            const result = getProbability(x, y, z, type);
            
            // 随机决定是否保留该点 (对比概率)
            // 乘上一个系数以调整整体亮度/密度
            if (Math.random() < result.p) {
                positions.push(x, y, z);
                
                // 根据相位上色
                if (result.phase > 0) {
                    colors.push(colorPos.r, colorPos.g, colorPos.b);
                } else {
                    colors.push(colorNeg.r, colorNeg.g, colorNeg.b);
                }
                count++;
            }
        }

        const geometry = new THREE.BufferGeometry();
        geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
        geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));

        particles = new THREE.Points(geometry, material);
        scene.add(particles);
    }

    // --- 交互逻辑 ---
    window.updateOrbital = function(type) {
        generateOrbital(type);
        
        // 更新按钮状态
        document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
        document.getElementById('btn-' + type).classList.add('active');

        // 更新文字说明
        const title = document.getElementById('desc-title');
        const text = document.getElementById('desc-text');
        
        if(type === '1s') {
            title.innerText = "1s 轨道 (n=1, l=0)";
            text.innerText = "最简单的球形。所有电子都以此为基础。没有节点，是一个实心的概率球。";
        } else if(type === '2s') {
            title.innerText = "2s 轨道 (n=2, l=0)";
            text.innerText = "虽然也是球形，但请注意观察内部！中间有一层是空的（黑圈），这叫‘径向节点’。就像一个俄罗斯套娃，外面一层，里面一层。";
        } else if(type === '2p') {
            title.innerText = "2p 轨道 (n=2, l=1)";
            text.innerText = "哑铃形。注意颜色的不同：一端是正相位（青），一端是负相位（红）。中间原子核位置是没有电子的（节点面）。";
        } else if(type === '3d') {
            title.innerText = "3d 轨道 (n=3, l=2)";
            text.innerText = "典型的‘四叶草’形状 (dx2-y2)。电子避开了x轴和y轴，钻到了四个象限里。这是过渡金属（如铁、铜）化学性质的关键。";
        } else if(type === '4f') {
            title.innerText = "4f 轨道 (n=4, l=3)";
            text.innerText = "极为复杂的八瓣花结构 (fxyz)。有8个‘气球’指向立方体的8个角。这就是为什么稀土元素的性质那么特殊且复杂。";
        }
    }

    // --- 动画循环 ---
    function animate() {
        requestAnimationFrame(animate);
        controls.update();
        if(particles) {
            particles.rotation.y += 0.002; // 缓慢自动旋转
        }
        renderer.render(scene, camera);
    }

    // 启动
    generateOrbital('1s');
    animate();

    // 窗口大小调整
    window.addEventListener('resize', () => {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    });
</script>
</body>
</html>