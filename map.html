<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>地图</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body { margin:0; font-family: system-ui, "Microsoft YaHei"; }
    #map { height: 100vh; }
    .bar{
      position: fixed; left: 12px; top: 12px; z-index: 999;
      padding: 10px 12px; border-radius: 12px;
      background: rgba(20,20,30,0.75); color: rgba(255,255,255,0.92);
      border: 1px solid rgba(255,255,255,0.14);
      backdrop-filter: blur(10px);
      max-width: min(420px, calc(100vw - 24px));
    }
    .bar a{ color: rgba(180,220,255,0.95); text-decoration: none; }
    .bar a:hover{ text-decoration: underline; }
    .small{ font-size: 12px; opacity: .8; margin-top: 4px; }
  </style>
</head>
<body>
  <div class="bar">
    <div><b id="title">地图</b> · <a href="./">回首页</a> · <a href="./planets.html">行星</a></div>
    <div class="small" id="desc">提示：从首页“世界时间”点进来会自动定位城市。</div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const CITIES = {
      beijing: { name: "北京",  lat: 39.9042, lng: 116.4074, z: 11 },
      london:  { name: "伦敦",  lat: 51.5074, lng: -0.1278,  z: 11 },
      newyork: { name: "纽约",  lat: 40.7128, lng: -74.0060, z: 11 },
      la:      { name: "洛杉矶",lat: 34.0522, lng: -118.2437,z: 11 }
    };

    function getParam(key){
      return new URLSearchParams(location.search).get(key);
    }

    const map = L.map("map").setView([39.9042, 116.4074], 4);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "&copy; OpenStreetMap"
    }).addTo(map);

    const cityKey = (getParam("city") || "").toLowerCase();
    if (CITIES[cityKey]) {
      const c = CITIES[cityKey];
      document.getElementById("title").textContent = `地图：${c.name}`;
      document.getElementById("desc").textContent = `已定位到 ${c.name}（${c.lat.toFixed(4)}, ${c.lng.toFixed(4)}）`;

      map.setView([c.lat, c.lng], c.z);
      L.marker([c.lat, c.lng]).addTo(map).bindPopup(`${c.name}`).openPopup();
    } else {
      document.getElementById("desc").textContent = "你也可以在首页点城市按钮，或在地址后加 ?city=beijing / london / newyork / la";
    }
  </script>
</body>
</html>
